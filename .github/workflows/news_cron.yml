name: Auto Refresh AI News

on:
  schedule:
    - cron: '0 */6 * * *' # 每 6 小时运行一次 (UTC 时间)
  workflow_dispatch: # 允许在 GitHub Actions 界面手动触发

jobs:
  refresh_news:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger News Update API
        run: |
          # 使用 curl 访问更新接口
          # 请确保在 GitHub 仓库的 Settings -> Secrets and variables -> Actions 中添加 ADMIN_PASSWORD
          response=$(curl -s -w "%{http_code}" -o /dev/null "https://aigit.pages.dev/api/admin/update_news?key=${{ secrets.ADMIN_PASSWORD }}")
          
          if [ "$response" -eq 200 ]; then
            echo "✅ News refreshed successfully."
          else
            echo "❌ Failed to refresh news. HTTP Status: $response"
            exit 1
          fi
